#!/bin/sh
':' //; exec "$(command -v nodejs || command -v node)" "$0" "$@"

var lisa    = require('./..'),
    version = require('./../package').version,
    command = process.argv[2],
    args    = process.argv.slice(2);

function pad(str, len, char) {
 return (str + new Array(len).join(char || ' ')).slice(0, len);
}

function example(str, desc) {
  console.log(pad(str, 45) + desc);
}

function help() {
  console.log('\nLisa v' + version);
  console.log('Usage: lisa [stage:role] [command:subcommand] [options]');

  console.log('\n Available commands:\n');
  console.log('new      -- Initialize a new remote.json file interactively.');

  lisa.show_tasks(args, process.stdout, function() {

    console.log(' Examples:\n');
    example('lisa console', 'opens console in primary host in default stage');
    example('lisa production console', 'opens console in primary host in production stage');

    example('lisa deploy', 'deploys to all roles in default stage');
    example('lisa production deploy', 'deploys to all roles in production stage');
    example('lisa staging:api deploy', 'deploys to role "api" in staging stage');
    example('lisa production:web deploy:restart', 'runs restart command from deploy task in web role in production');

    example('lisa logs', 'tails first log file defined for all roles in default stage');
    example('lisa production logs puma', 'tails "puma" log file defined in production stage');
    example('lisa staging:workers logs log/rake.log', 'tails specific log file in workers role in staging stage.');

    console.log()
  })

}

if (!command || command == 'help')
  help()
else if (command == 'new')
  lisa.build(args);
else
  lisa.run(args);
